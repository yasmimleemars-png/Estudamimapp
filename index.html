<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EstudaMim</title>
    
    <!-- Design e Fontes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- React (Motor do App) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (Tradutor de C√≥digo) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .font-serif { font-family: 'Playfair Display', serif; }
        .font-sans { font-family: 'Lato', sans-serif; }
        body { background-color: #FDFBF7; -webkit-tap-highlight-color: transparent; }
        /* Anima√ß√£o do Gr√°fico */
        @keyframes pie-in { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .pie-chart-anim { animation: pie-in 0.5s ease-out; }
    </style>
</head>
<body>
    <!-- Mensagem de Carregamento (some quando o app inicia) -->
    <div id="root" class="flex h-screen w-full items-center justify-center text-stone-400 font-serif">
        <div class="text-center">
            <i class="fa-solid fa-paw text-4xl mb-3 animate-bounce text-rose-300"></i>
            <p>Carregando EstudaMim...</p>
        </div>
    </div>

    <!-- Script de Seguran√ßa para Erros -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            document.body.innerHTML = '<div style="padding:20px; color:red; font-family:sans-serif;"><h3>Ops! Algo deu errado.</h3><p>Erro: ' + message + '</p><p>Tente recarregar a p√°gina.</p></div>';
        };
    </script>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- COMPONENTE DE GR√ÅFICO LEVE (CSS PURO) ---
        // Substitui a biblioteca pesada para evitar tela branca
        const SimplePieChart = ({ data }) => {
            const total = data.reduce((acc, curr) => acc + curr.value, 0);
            
            if (total === 0) return (
                <div className="flex flex-col items-center justify-center h-64 text-stone-300">
                    <i className="fa-regular fa-clock text-5xl mb-3 opacity-20"></i>
                    <p className="text-sm">Sem dados neste per√≠odo</p>
                </div>
            );

            let currentPos = 0;
            const gradientParts = data.map(item => {
                const percent = (item.value / total) * 100;
                const endPos = currentPos + percent;
                const part = `${item.color} ${currentPos}% ${endPos}%`;
                currentPos = endPos;
                return part;
            });

            return (
                <div className="h-64 flex items-center justify-center relative pie-chart-anim">
                    {/* Gr√°fico Pizza via Conic Gradient */}
                    <div style={{
                        width: '200px', height: '200px', borderRadius: '50%',
                        background: `conic-gradient(${gradientParts.join(', ')})`,
                        position: 'relative', zIndex: 1
                    }}></div>
                    
                    {/* Buraco do meio (Donut) */}
                    <div className="absolute bg-white rounded-full w-32 h-32 z-10 flex flex-col items-center justify-center shadow-inner">
                        <span className="text-3xl font-bold text-stone-800">{(total/60).toFixed(1)}</span>
                        <span className="text-[10px] text-stone-400 uppercase tracking-widest font-bold">Horas</span>
                    </div>

                    {/* Legenda Flutuante */}
                    <div className="absolute bottom-0 w-full flex justify-center gap-2 flex-wrap px-4">
                        {data.slice(0,3).map((d, i) => (
                            <div key={i} className="flex items-center gap-1 bg-white/80 px-2 py-1 rounded-lg text-xs shadow-sm backdrop-blur-sm">
                                <span className="w-2 h-2 rounded-full" style={{backgroundColor: d.color}}></span>
                                <span className="text-stone-600 font-bold">{Math.round((d.value/total)*100)}%</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const COLORS = ['#E88D93', '#3B7CA8', '#D4A373', '#8D6E63', '#A8D5BA', '#93C5FD', '#FCA5A5'];

        const EstudaMim = () => {
            const [view, setView] = useState('dashboard');
            const [timeRange, setTimeRange] = useState('day');
            
            // Dados Iniciais
            const [subjects, setSubjects] = useState([
                { id: 1, name: 'Matem√°tica', color: '#3B7CA8' },
                { id: 2, name: 'Portugu√™s', color: '#E88D93' },
                { id: 3, name: 'Hist√≥ria', color: '#D4A373' },
            ]);
            const [sessions, setSessions] = useState([
                { id: 1, subjectId: 1, date: new Date().toISOString(), duration: 60, notes: '√Ålgebra linear' },
                { id: 2, subjectId: 2, date: new Date().toISOString(), duration: 45, notes: 'Reda√ß√£o' },
                { id: 3, subjectId: 1, date: new Date(Date.now() - 86400000).toISOString(), duration: 120, notes: 'Geometria' },
            ]);

            // Form States
            const [newSubjectName, setNewSubjectName] = useState('');
            const [newSubjectColor, setNewSubjectColor] = useState(COLORS[0]);
            const [logSubjectId, setLogSubjectId] = useState('');
            const [logDate, setLogDate] = useState(new Date().toISOString().substr(0, 10));
            const [logDuration, setLogDuration] = useState('');
            const [logNotes, setLogNotes] = useState('');
            const [editingSessionId, setEditingSessionId] = useState(null);

            // Filtros
            const filteredSessions = useMemo(() => {
                const now = new Date();
                const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
                return sessions.filter(session => {
                    const sDate = new Date(session.date).getTime();
                    if (timeRange === 'day') return sDate >= todayStart && sDate < todayStart + 86400000;
                    if (timeRange === 'week') return sDate >= todayStart - (now.getDay() * 86400000);
                    if (timeRange === 'month') return new Date(session.date).getMonth() === now.getMonth();
                    return new Date(session.date).getFullYear() === now.getFullYear();
                });
            }, [sessions, timeRange]);

            const pieData = useMemo(() => {
                const data = {};
                filteredSessions.forEach(session => {
                    const sub = subjects.find(s => s.id === parseInt(session.subjectId));
                    if (sub) {
                        if (!data[sub.name]) data[sub.name] = { name: sub.name, value: 0, color: sub.color };
                        data[sub.name].value += parseInt(session.duration);
                    }
                });
                return Object.values(data);
            }, [filteredSessions, subjects]);

            // Handlers
            const handleAddSubject = () => {
                if (!newSubjectName) return;
                const newId = Date.now();
                setSubjects([...subjects, { id: newId, name: newSubjectName, color: newSubjectColor }]);
                setNewSubjectName('');
            };

            const handleSaveSession = () => {
                if (!logSubjectId || !logDuration) return;
                const payload = {
                    subjectId: parseInt(logSubjectId),
                    date: new Date(logDate).toISOString(),
                    duration: parseInt(logDuration),
                    notes: logNotes
                };
                if (editingSessionId) {
                    setSessions(sessions.map(s => s.id === editingSessionId ? { ...payload, id: editingSessionId } : s));
                    setEditingSessionId(null);
                } else {
                    setSessions([...sessions, { ...payload, id: Date.now() }]);
                }
                setLogDuration(''); setLogNotes(''); setView('dashboard');
            };

            const handleDeleteSession = (id) => setSessions(sessions.filter(s => s.id !== id));
            const handleDeleteSubject = (id) => setSubjects(subjects.filter(s => s.id !== id));

            // UI Components
            const NavBtn = ({ icon, label, target }) => (
                <button onClick={() => { setView(target); if(target==='log'){ setEditingSessionId(null); setLogDuration(''); setLogNotes(''); }}}
                    className={`flex flex-col items-center p-2 rounded-xl transition ${view === target ? 'text-rose-500 font-bold' : 'text-stone-400'}`}>
                    <i className={`fa-solid ${icon} text-xl mb-1`}></i><span className="text-[10px]">{label}</span>
                </button>
            );

            const TimeBtn = ({ label, val }) => (
                <button onClick={() => setTimeRange(val)} className={`px-3 py-1 rounded-full text-xs font-bold ${timeRange === val ? 'bg-sky-600 text-white' : 'bg-white text-stone-500 border'}`}>{label}</button>
            );

            return (
                <div className="flex justify-center min-h-screen bg-stone-100">
                    <div className="w-full max-w-md bg-[#FDFBF7] shadow-xl relative flex flex-col h-screen">
                        {/* Header */}
                        <header className="px-6 pt-10 pb-4 bg-white rounded-b-[30px] shadow-sm z-20 flex justify-between items-center shrink-0">
                            <div>
                                <h1 className="text-3xl font-serif font-black text-stone-800">Estuda<span className="text-rose-400 italic">Mim</span></h1>
                                <p className="text-stone-400 text-xs mt-1">Ol√°, estudante!</p>
                            </div>
                            <div className="w-10 h-10 bg-sky-100 rounded-full flex items-center justify-center border-2 border-white text-xl">üê∂</div>
                        </header>

                        {/* Conte√∫do com Scroll */}
                        <main className="flex-1 overflow-y-auto p-4 pb-24 custom-scrollbar">
                            {view === 'dashboard' && (
                                <div className="space-y-4 animate-fade-in">
                                    <div className="bg-white p-5 rounded-3xl shadow-sm border border-stone-100">
                                        <div className="flex justify-between items-center mb-2">
                                            <h2 className="font-bold text-stone-700">Resumo</h2>
                                            <div className="flex gap-1">
                                                <TimeBtn label="Hoje" val="day" /><TimeBtn label="Sem" val="week" /><TimeBtn label="M√™s" val="month" />
                                            </div>
                                        </div>
                                        <SimplePieChart data={pieData} />
                                    </div>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="bg-rose-100 p-4 rounded-2xl text-rose-800">
                                            <p className="text-xs opacity-70 mb-1">Foco Principal</p>
                                            <p className="font-bold text-lg leading-tight">{pieData.length ? pieData.sort((a,b)=>b.value-a.value)[0].name : '-'}</p>
                                        </div>
                                        <div className="bg-sky-100 p-4 rounded-2xl text-sky-800">
                                            <p className="text-xs opacity-70 mb-1">Total Sess√µes</p>
                                            <p className="font-bold text-lg">{filteredSessions.length}</p>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {view === 'subjects' && (
                                <div className="space-y-4">
                                    <div className="bg-white p-5 rounded-3xl shadow-sm">
                                        <h2 className="font-bold mb-3">Nova Disciplina</h2>
                                        <input className="w-full p-3 bg-stone-50 rounded-xl mb-3 outline-none focus:ring-2 focus:ring-rose-200" placeholder="Nome..." value={newSubjectName} onChange={e=>setNewSubjectName(e.target.value)} />
                                        <div className="flex gap-2 mb-3 overflow-x-auto pb-2">
                                            {COLORS.map(c => <button key={c} onClick={()=>setNewSubjectColor(c)} className={`w-8 h-8 rounded-full shrink-0 border-2 ${newSubjectColor===c ? 'border-stone-800 scale-110':'border-transparent'}`} style={{backgroundColor:c}}/>)}
                                        </div>
                                        <button onClick={handleAddSubject} className="w-full py-3 bg-stone-800 text-white rounded-xl font-bold">Adicionar</button>
                                    </div>
                                    <div className="space-y-2">
                                        {subjects.map(s => (
                                            <div key={s.id} className="flex justify-between items-center p-3 bg-white rounded-xl border border-stone-100">
                                                <div className="flex items-center gap-3"><div className="w-3 h-8 rounded-full" style={{background:s.color}}></div><span className="font-bold text-stone-700">{s.name}</span></div>
                                                <button onClick={()=>handleDeleteSubject(s.id)} className="text-stone-300 p-2"><i className="fa-solid fa-trash"></i></button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {view === 'log' && (
                                <div className="bg-white p-5 rounded-3xl shadow-sm h-full flex flex-col">
                                    <h2 className="text-center font-serif font-bold text-xl mb-6">{editingSessionId ? 'Editar' : 'Registrar'}</h2>
                                    <div className="space-y-4 flex-1">
                                        <div><label className="text-xs font-bold text-stone-400 uppercase">Data</label><input type="date" value={logDate} onChange={e=>setLogDate(e.target.value)} className="w-full p-3 bg-stone-50 rounded-xl mt-1"/></div>
                                        <div>
                                            <label className="text-xs font-bold text-stone-400 uppercase">Mat√©ria</label>
                                            <div className="grid grid-cols-2 gap-2 mt-1 max-h-32 overflow-y-auto">
                                                {subjects.map(s => <button key={s.id} onClick={()=>setLogSubjectId(s.id)} className={`p-2 rounded-lg border text-left text-sm font-bold ${logSubjectId===s.id ? 'bg-sky-50 border-sky-500 text-sky-700':'bg-stone-50 border-transparent text-stone-600'}`}><span style={{color:s.color}}>‚óè</span> {s.name}</button>)}
                                            </div>
                                        </div>
                                        <div><label className="text-xs font-bold text-stone-400 uppercase">Minutos</label><input type="number" value={logDuration} onChange={e=>setLogDuration(e.target.value)} className="w-full p-3 bg-stone-50 rounded-xl text-xl font-bold mt-1" placeholder="0"/></div>
                                    </div>
                                    <button onClick={handleSaveSession} className="w-full py-4 bg-rose-400 text-white rounded-xl font-bold text-lg mt-4 shadow-lg shadow-rose-200">Salvar</button>
                                </div>
                            )}

                            {view === 'history' && (
                                <div className="space-y-3">
                                    <h2 className="font-bold px-2">Hist√≥rico</h2>
                                    {sessions.sort((a,b)=>new Date(b.date)-new Date(a.date)).map(s => {
                                        const sub = subjects.find(sb=>sb.id===s.subjectId);
                                        return (
                                            <div key={s.id} className="bg-white p-4 rounded-2xl border border-stone-50 shadow-sm">
                                                <div className="flex justify-between items-start mb-2">
                                                    <div><h4 className="font-bold text-sm" style={{color:sub?.color}}>{sub?.name}</h4><p className="text-xs text-stone-400">{new Date(s.date).toLocaleDateString()}</p></div>
                                                    <span className="font-bold text-stone-600 bg-stone-100 px-2 py-1 rounded-lg text-xs">{s.duration} min</span>
                                                </div>
                                                <div className="flex justify-end gap-3 pt-2 border-t border-stone-50">
                                                    <button onClick={()=>handleEditSession(s)} className="text-xs font-bold text-sky-600">EDITAR</button>
                                                    <button onClick={()=>handleDeleteSession(s.id)} className="text-xs font-bold text-rose-400">EXCLUIR</button>
                                                </div>
                                            </div>
                                        )
                                    })}
                                </div>
                            )}
                        </main>

                        {/* Menu Inferior */}
                        <nav className="absolute bottom-6 left-4 right-4 bg-white rounded-2xl shadow-xl p-2 flex justify-around items-center border border-stone-100 z-30">
                            <NavBtn icon="fa-chart-pie" label="Resumo" target="dashboard" />
                            <NavBtn icon="fa-book" label="Mat√©rias" target="subjects" />
                            <button onClick={()=>{setView('log');setEditingSessionId(null);setLogDuration('');setLogNotes('');}} className="bg-stone-800 text-white w-12 h-12 rounded-full flex items-center justify-center -mt-6 border-4 border-[#FDFBF7] shadow-lg"><i className="fa-solid fa-plus"></i></button>
                            <NavBtn icon="fa-list" label="Hist√≥rico" target="history" />
                            <div className="w-8"></div>
                        </nav>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EstudaMim />);
    </script>
</body>
</html>
